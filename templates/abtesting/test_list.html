{% extends 'base_sidebar.html' %} 
{% load static %} 
{% block title %}A/B Tests - CreatorFlow{% endblock %} 
{% block extra_css %}
<style>
  .test-card {
    background: var(--paper);
    border: var(--panel-border);
    box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.1);
    padding: 30px;
    border-radius: 0;
    transition: transform 0.3s ease;
    margin-bottom: 20px;
  }

  .test-card:hover {
    transform: translate(-4px, -4px);
    box-shadow: 12px 12px 0 rgba(255, 59, 48, 0.3);
  }

  .status-badge {
    font-family: "Oswald", sans-serif;
    font-size: 0.9rem;
    padding: 5px 15px;
    border-radius: 20px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .status-draft {
    background: var(--gray-wash);
    color: var(--ink);
  }

  .status-active {
    background: #34c759;
    color: white;
  }

  .status-paused {
    background: #ff9500;
    color: white;
  }

  .status-completed {
    background: var(--ink);
    color: white;
  }

  .progress-bar-custom {
    height: 8px;
    background: var(--gray-wash);
    border-radius: 4px;
    overflow: hidden;
    margin: 10px 0;
  }

  .progress-fill {
    height: 100%;
    background: var(--accent-red);
    transition: width 0.3s ease;
  }

  .test-type-icon {
    font-size: 2rem;
    color: var(--accent-red);
    margin-right: 15px;
  }
</style>
{% endblock %} 
{% block content %}
<div id="view-abtesting-list" class="view-section">
  <div class="abtesting-list">
    <div
      class="d-flex justify-content-between align-items-center mb-4"
      style="margin-bottom: 20px"
    >
      <h1
        class="display-4"
        style="font-family: 'Oswald', sans-serif; font-weight: 700"
        style="margin-bottom: 20px"
      >
        <i class="fas fa-flask"></i> A/B Tests
      </h1>

      <a
        href="{% url 'abtesting:create_test' %}"
        class="btn btn-dark btn-lg"
        style="margin-bottom: 10px"
      >
        <i class="fas fa-plus"></i> Create New Test
      </a>
    </div>

    {% if not test_data %}
    <div class="test-card text-center" style="margin-bottom: 10px">
      <i class="fas fa-flask fa-4x mb-3" style="color: var(--gray-wash)"></i>
      <h3 style="font-family: 'Oswald', sans-serif">No A/B Tests Yet</h3>
      <p class="text-muted">
        Create your first A/B test to optimize your video performance
      </p>
      <a href="{% url 'abtesting:create_test' %}" class="btn btn-dark mt-3">
        <i class="fas fa-plus"></i> Create Test
      </a>
    </div>
    {% else %}
    <!-- Filter by status -->
    <div class="mb-4" style="margin-bottom: 20px">
      <button class="btn btn-outline-dark active" data-filter="all">All</button>
      <button class="btn btn-outline-dark" data-filter="active">Active</button>
      <button class="btn btn-outline-dark" data-filter="draft">Draft</button>
      <button class="btn btn-outline-dark" data-filter="completed">
        Completed
      </button>
    </div>

    <!-- Test Cards
        {% for item in test_data %}
        <div class="test-card" data-status="{{ item.test.status }}">
            <div class="row align-items-center">
                <div class="col-md-1 text-center">
                    {% if item.test.test_type == 'thumbnail' %}
                        <i class="fas fa-image test-type-icon"></i>
                    {% elif item.test.test_type == 'title' %}
                        <i class="fas fa-heading test-type-icon"></i>
                    {% elif item.test.test_type == 'description' %}
                        <i class="fas fa-align-left test-type-icon"></i>
                    {% elif item.test.test_type == 'combined' %}
                        <i class="fas fa-layer-group test-type-icon"></i>
                    {% endif %}
                </div>
                
                <div class="col-md-5">
                    <h4 style="font-family: 'Oswald', sans-serif; margin-bottom: 5px;">
                        {{ item.test.video_title }}
                    </h4>
                    <p class="text-muted mb-2">
                        <small>{{ item.test.get_test_type_display }} Test · {{ item.variant_count }} Variants</small>
                    </p>
                    <span class="status-badge status-{{ item.test.status }}">
                        {{ item.test.get_status_display }}
                    </span>
                </div>
                
                <div class="col-md-4">
                    {% if item.test.status == 'active' %}
                        <div class="mb-2">
                            <small class="text-muted">Progress</small>
                            <div class="progress-bar-custom">
                                <div class="progress-fill" style="width: {{ item.progress_percentage }}%"></div>
                            </div>
                            <small class="text-muted">{{ item.progress_percentage }}% complete</small>
                        </div>
                        
                        {% if item.current_variant %}
                            <p class="mb-0">
                                <small><strong>Current Variant:</strong> {{ item.current_variant.variant_name }}</small>
                            </p>
                        {% endif %}
                        
                        {% if item.time_remaining %}
                            <p class="mb-0">
                                <small class="text-muted">
                                    <i class="fas fa-clock"></i> 
                                    {% if item.time_remaining.days > 0 %}
                                        {{ item.time_remaining.days }}d 
                                    {% endif %}
                                    {{ item.time_remaining.seconds|floatformat:0|divisibleby:3600 }}h remaining
                                </small>
                            </p>
                        {% endif %}
                    {% elif item.test.status == 'completed' and item.test.winner_variant %}
                        <p class="mb-0">
                            <i class="fas fa-trophy" style="color: #FFD700;"></i>
                            <strong>Winner:</strong> Variant {{ item.test.winner_variant.variant_name }}
                        </p>
                    {% elif item.test.status == 'draft' %}
                        <p class="text-muted mb-0">
                            <i class="fas fa-info-circle"></i> Ready to start
                        </p>
                    {% endif %}
                </div>
                
                <div class="col-md-2 text-end">
                    <a href="{% url 'abtesting:test_detail' item.test.id %}" class="btn btn-outline-dark">
                        View Details
                    </a>
                </div>
            </div>
        </div>
        {% endfor %} -->

    <!-- A/B Tests Grid Layout -->
    <div
      style="
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: var(--space-5);
        margin-bottom: var(--space-6);
      "
    >
      {% for item in test_data %}
      <div class="card card-interactive" data-status="{{ item.test.status }}">
        <div class="card-body" style="padding: var(--space-5)">
          <!-- Header with Icon and Status -->
          <div
            style="
              display: flex;
              align-items: flex-start;
              justify-content: space-between;
              margin-bottom: var(--space-4);
            "
          >
            <div
              style="display: flex; align-items: center; gap: var(--space-3)"
            >
              <!-- Test Type Icon -->
              <div
                style="
                  width: 48px;
                  height: 48px;
                  border-radius: var(--radius-md);
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: var(--text-2xl);
                  background: var(--gray-100);
                  color: var(--ink);
                  border: 2px solid var(--ink);
                "
              >
                {% if item.test.test_type == 'thumbnail' %}
                <i class="fas fa-image"></i>
                {% elif item.test.test_type == 'title' %}
                <i class="fas fa-heading"></i>
                {% elif item.test.test_type == 'description' %}
                <i class="fas fa-align-left"></i>
                {% elif item.test.test_type == 'combined' %}
                <i class="fas fa-layer-group"></i>
                {% endif %}
              </div>

              <!-- Status Badge -->
              <div>
                {% if item.test.status == 'active' %}
                <span class="card-badge card-badge-success"
                  >{{ item.test.get_status_display }}</span
                >
                {% elif item.test.status == 'completed' %}
                <span class="card-badge card-badge-info"
                  >{{ item.test.get_status_display }}</span
                >
                {% elif item.test.status == 'draft' %}
                <span class="card-badge"
                  >{{ item.test.get_status_display }}</span
                >
                {% elif item.test.status == 'paused' %}
                <span class="card-badge card-badge-warning"
                  >{{ item.test.get_status_display }}</span
                >
                {% endif %}
              </div>
            </div>
          </div>

          <!-- Video Title -->
          <h4
            style="
              font-family: var(--font-display);
              font-weight: var(--font-bold);
              text-transform: uppercase;
              margin-bottom: var(--space-2);
              color: var(--ink);
              font-size: var(--text-lg);
              line-height: var(--leading-tight);
            "
          >
            {{ item.test.video_title }}
          </h4>

          <!-- Test Info -->
          <p
            style="
              color: var(--gray-600);
              font-size: var(--text-sm);
              margin-bottom: var(--space-4);
            "
          >
            {{ item.test.get_test_type_display }} Test · {{ item.variant_count
            }} Variants
          </p>

          <!-- Test Details Section -->
          <div
            style="
              padding: var(--space-4);
              background: var(--gray-50);
              border-radius: var(--radius-md);
              margin-bottom: var(--space-4);
            "
          >
            {% if item.test.status == 'active' %}
            <!-- Progress Bar -->
            <div style="margin-bottom: var(--space-3)">
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: var(--space-2);
                "
              >
                <small
                  style="
                    color: var(--gray-600);
                    font-weight: var(--font-semibold);
                    text-transform: uppercase;
                    font-size: var(--text-xs);
                  "
                  >Progress</small
                >
                <small
                  style="
                    color: var(--ink);
                    font-weight: var(--font-bold);
                    font-size: var(--text-xs);
                  "
                  >{{ item.progress_percentage }}%</small
                >
              </div>
              <div
                style="
                  height: 8px;
                  background: var(--gray-200);
                  border-radius: var(--radius-full);
                  overflow: hidden;
                  border: 1px solid var(--ink);
                "
              >
                <div
                  style="height: 100%; background: var(--accent-green); width: {{ item.progress_percentage }}%; transition: width 0.3s ease;"
                ></div>
              </div>
            </div>

            <!-- Current Variant -->
            {% if item.current_variant %}
            <div
              style="
                display: flex;
                align-items: center;
                gap: var(--space-2);
                margin-bottom: var(--space-2);
              "
            >
              <i
                class="fas fa-play-circle"
                style="color: var(--accent-green); font-size: var(--text-sm)"
              ></i>
              <small style="color: var(--gray-700); font-size: var(--text-sm)">
                <strong>Current:</strong> Variant {{
                item.current_variant.variant_name }}
              </small>
            </div>
            {% endif %}

            <!-- Time Remaining -->
            {% if item.time_remaining %}
            <div
              style="display: flex; align-items: center; gap: var(--space-2)"
            >
              <i
                class="fas fa-clock"
                style="color: var(--gray-600); font-size: var(--text-sm)"
              ></i>
              <small style="color: var(--gray-700); font-size: var(--text-sm)">
                {% if item.time_remaining.days > 0 %} {{
                item.time_remaining.days }}d {% endif %} {{
                item.time_remaining.seconds|floatformat:0|divisibleby:3600 }}h
                remaining
              </small>
            </div>
            {% endif %} {% elif item.test.status == 'completed' and
            item.test.winner_variant %}
            <!-- Winner Display -->
            <div
              style="display: flex; align-items: center; gap: var(--space-2)"
            >
              <i
                class="fas fa-trophy"
                style="color: #ffd700; font-size: var(--text-xl)"
              ></i>
              <div>
                <small
                  style="
                    color: var(--gray-600);
                    font-size: var(--text-xs);
                    display: block;
                    text-transform: uppercase;
                    font-weight: var(--font-semibold);
                  "
                  >Winner</small
                >
                <strong style="color: var(--ink); font-size: var(--text-base)"
                  >Variant {{ item.test.winner_variant.variant_name }}</strong
                >
              </div>
            </div>

            {% elif item.test.status == 'draft' %}
            <!-- Draft Status -->
            <div
              style="display: flex; align-items: center; gap: var(--space-2)"
            >
              <i
                class="fas fa-info-circle"
                style="color: var(--accent-blue); font-size: var(--text-lg)"
              ></i>
              <span style="color: var(--gray-700); font-size: var(--text-sm)"
                >Ready to start</span
              >
            </div>
            {% endif %}
          </div>

          <!-- View Details Button -->
          <a
            href="{% url 'abtesting:test_detail' item.test.id %}"
            class="btn btn-primary btn-block"
          >
            <i class="fas fa-chart-line"></i>
            <span>View Details</span>
          </a>
        </div>
      </div>
      {% endfor %}
    </div>

    {% endif %}
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  // Filter functionality
  document.querySelectorAll("[data-filter]").forEach((button) => {
    button.addEventListener("click", function () {
      const filter = this.dataset.filter;

      // Update active button
      document
        .querySelectorAll("[data-filter]")
        .forEach((btn) => btn.classList.remove("active"));
      this.classList.add("active");

      // Filter cards
      document.querySelectorAll(".test-card").forEach((card) => {
        if (filter === "all" || card.dataset.status === filter) {
          card.style.display = "block";
        } else {
          card.style.display = "none";
        }
      });
    });
  });
</script>
{% endblock %}
