{% extends 'base.html' %}

{% block title %}{{ title }} - Creator Backoffice{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>{{ title }}</h2>
            <div>
                <a href="{% url 'approvals:pending_approvals' %}" class="btn btn-outline-primary">
                    <i class="bi bi-clock-history"></i> Pending Approvals
                </a>
                <a href="{% url 'approvals:request_list' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-list"></i> All Requests
                </a>
            </div>
        </div>
        
        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center border-warning">
                    <div class="card-body">
                        <h3 class="text-warning">{{ pending_requests.count }}</h3>
                        <p class="mb-0">Pending</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center border-success">
                    <div class="card-body">
                        <h3 class="text-success">{{ approved_requests.count }}</h3>
                        <p class="mb-0">Approved</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center border-danger">
                    <div class="card-body">
                        <h3 class="text-danger">{{ rejected_requests.count }}</h3>
                        <p class="mb-0">Rejected</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center border-info">
                    <div class="card-body">
                        <h3 class="text-info">{{ uploaded_requests.count }}</h3>
                        <p class="mb-0">Uploaded</p>
                    </div>
                </div>
            </div>
        </div>
        
        {% if all_requests %}
            <!-- Tabs for filtering by status -->
            <ul class="nav nav-tabs mb-3" id="historyTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab">
                        All ({{ all_requests.count }})
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab">
                        Pending ({{ pending_requests.count }})
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button" role="tab">
                        Approved ({{ approved_requests.count }})
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="rejected-tab" data-bs-toggle="tab" data-bs-target="#rejected" type="button" role="tab">
                        Rejected ({{ rejected_requests.count }})
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="uploaded-tab" data-bs-toggle="tab" data-bs-target="#uploaded" type="button" role="tab">
                        Uploaded ({{ uploaded_requests.count }})
                    </button>
                </li>
            </ul>
            
            <div class="tab-content" id="historyTabContent">
                <!-- All Requests Tab -->
                <div class="tab-pane fade show active" id="all" role="tabpanel">
                    {% include 'approvals/partials/request_table.html' with requests=all_requests %}
                </div>
                
                <!-- Pending Tab -->
                <div class="tab-pane fade" id="pending" role="tabpanel">
                    {% if pending_requests %}
                        {% include 'approvals/partials/request_table.html' with requests=pending_requests %}
                    {% else %}
                        <div class="alert alert-info">No pending requests.</div>
                    {% endif %}
                </div>
                
                <!-- Approved Tab -->
                <div class="tab-pane fade" id="approved" role="tabpanel">
                    {% if approved_requests %}
                        {% include 'approvals/partials/request_table.html' with requests=approved_requests %}
                    {% else %}
                        <div class="alert alert-info">No approved requests.</div>
                    {% endif %}
                </div>
                
                <!-- Rejected Tab -->
                <div class="tab-pane fade" id="rejected" role="tabpanel">
                    {% if rejected_requests %}
                        {% include 'approvals/partials/request_table.html' with requests=rejected_requests %}
                    {% else %}
                        <div class="alert alert-info">No rejected requests.</div>
                    {% endif %}
                </div>
                
                <!-- Uploaded Tab -->
                <div class="tab-pane fade" id="uploaded" role="tabpanel">
                    {% if uploaded_requests %}
                        {% include 'approvals/partials/request_table.html' with requests=uploaded_requests %}
                    {% else %}
                        <div class="alert alert-info">No uploaded requests.</div>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div class="alert alert-info">
                <h5>No approval requests found</h5>
                <p>There are no approval requests from your team members yet.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
