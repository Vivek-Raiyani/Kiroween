{% extends 'base.html' %}

{% block title %}{{ title }} - Creator Backoffice{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 offset-lg-2">
        <div class="mb-4">
            <a href="{% url 'approvals:youtube_upload_list' %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back to Upload List
            </a>
        </div>
        
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h4 class="mb-0">
                    <i class="bi bi-youtube"></i> Upload to YouTube
                </h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h6><i class="bi bi-info-circle"></i> Video Information</h6>
                    <p class="mb-1"><strong>File:</strong> {{ request_obj.file.name }}</p>
                    <p class="mb-1"><strong>Size:</strong> {{ request_obj.file.get_size_display }}</p>
                    <p class="mb-1"><strong>Type:</strong> {{ request_obj.file.mime_type }}</p>
                    <p class="mb-1"><strong>Submitted by:</strong> {{ request_obj.editor.username }}</p>
                    <p class="mb-0"><strong>Approved by:</strong> {{ request_obj.reviewed_by.username }} on {{ request_obj.reviewed_at|date:"Y-m-d H:i" }}</p>
                </div>
                
                {% if request_obj.description %}
                    <div class="alert alert-secondary">
                        <h6>Editor's Description:</h6>
                        <p class="mb-0">{{ request_obj.description }}</p>
                    </div>
                {% endif %}
                
                <form method="post" id="uploadForm" data-loading-message="Uploading video to YouTube... This may take several minutes.">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="title" class="form-label">Video Title <span class="text-danger">*</span></label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="title" 
                            name="title" 
                            required 
                            maxlength="100"
                            placeholder="Enter a compelling title for your video"
                            value="{{ request_obj.file.name|slice:':100' }}"
                        >
                        <small class="form-text text-muted">Maximum 100 characters</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">Video Description <span class="text-danger">*</span></label>
                        <textarea 
                            class="form-control" 
                            id="description" 
                            name="description" 
                            rows="6" 
                            required
                            maxlength="5000"
                            placeholder="Provide a detailed description of your video content"
                        >{{ request_obj.description }}</textarea>
                        <small class="form-text text-muted">Maximum 5000 characters. This will be visible to viewers on YouTube.</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="privacy_status" class="form-label">Privacy Status <span class="text-danger">*</span></label>
                        <select class="form-select" id="privacy_status" name="privacy_status" required>
                            <option value="private" selected>Private - Only you and people you choose can watch</option>
                            <option value="unlisted">Unlisted - Anyone with the link can watch</option>
                            <option value="public">Public - Everyone can watch</option>
                        </select>
                        <small class="form-text text-muted">You can change this later in YouTube Studio</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="tags" class="form-label">Tags (Optional)</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="tags" 
                            name="tags" 
                            placeholder="tag1, tag2, tag3"
                        >
                        <small class="form-text text-muted">Separate tags with commas. Tags help viewers find your video.</small>
                    </div>
                    
                    <div class="alert alert-warning">
                        <h6><i class="bi bi-exclamation-triangle"></i> Important Notes:</h6>
                        <ul class="mb-0">
                            <li>The upload process may take several minutes depending on file size</li>
                            <li>Do not close this page until the upload is complete</li>
                            <li>Make sure you have sufficient YouTube API quota available</li>
                            <li>The video will be processed by YouTube after upload</li>
                        </ul>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-danger btn-lg" id="uploadBtn">
                            <i class="bi bi-youtube"></i> Upload to YouTube
                        </button>
                        <a href="{% url 'approvals:youtube_upload_list' %}" class="btn btn-outline-secondary">
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('uploadForm').addEventListener('submit', function(e) {
    const uploadBtn = document.getElementById('uploadBtn');
    uploadBtn.disabled = true;
    uploadBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Uploading...';
});
</script>
{% endblock %}
